<!DOCTYPE html>
<html lang="es">
<head>
  <!-- Script fail-safe para evitar ReferenceError en móviles -->
  <script type="text/javascript">
    // Definir objeto global que falta y causa White Screen of Death
    window.com_asfmapps_f12_obj = window.com_asfmapps_f12_obj || {
      ready: true,
      version: '1.0.0',
      _stub: function() { return true; }
    };
    
    // Capturar errores de carga de chunks (code splitting)
    (function() {
      var originalFetch = window.fetch;
      window.fetch = function() {
        var args = Array.prototype.slice.call(arguments);
        return originalFetch.apply(this, args).catch(function(err) {
          var url = args[0];
          if (url && typeof url === 'string' && (url.includes('.js') || url.includes('chunk'))) {
            console.warn('[ChunkLoadError] Detected failed chunk load, triggering reload:', url);
            // Forzar recarga suave después de un pequeño delay
            setTimeout(function() {
              window.location.reload();
            }, 100);
          }
          throw err;
        });
      };
    })();
    
    // Escuchar evento error global para捕获 chunk errors
    window.addEventListener('error', function(e) {
      var message = e.message || '';
      var filename = e.filename || '';
      
      // Detectar errores de chunks faltantes
      if (message.includes('Failed to fetch dynamically imported module') ||
          message.includes('Loading chunk') ||
          message.includes('chunk') ||
          (filename && filename.includes('.js') && !filename.includes('index'))) {
        console.warn('[ChunkLoadError] Chunk load failure detected:', message);
        // No recargar inmediatamente para evitar loop
        if (!window.__chunkReloadAttempted) {
          window.__chunkReloadAttempted = true;
          setTimeout(function() {
            window.location.reload();
          }, 500);
        }
      }
    }, true);
    
    // Cleanup en pagehide para prevenir problemas al volver
    window.addEventListener('pagehide', function() {
      window.__chunkReloadAttempted = false;
    });
  </script>
  <script type="text/javascript">
    (function(l) {
        if (l.search) {
            var q = {};
            l.search.slice(1).split('&').forEach(function(v) {
                var a = v.split('=');
                q[a[0]] = a.slice(1).join('=').replace(/~and~/g, '&');
            });
            if (q.p !== undefined) {
                window.history.replaceState(null, null, l.pathname.slice(0, -1) + (q.p || '') + (l.hash || ''));
            }
        }
    }(window.location));
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="theme-color" content="#0b141a">
  
  <!-- Preconnect hints -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://idghvkvkfdklvkvkdvkv.supabase.co">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://idghvkvkfdklvkvkdvkv.supabase.co">
  
  <!-- SEO Básico -->
  <title>TradingChango | Compará Precios de Supermercados en Argentina</title>
  <meta name="description" content="Compará precios de supermercados en Argentina. Coto, Carrefour, Jumbo, Día y Mas Online. Ahorrá hasta 30% en tu carrito con TradingChango.">
  <meta name="keywords" content="precios supermercados, comparar precios, Argentina, Coto, Carrefour, Jumbo, ofertas, inflación, ahorro">
  <meta name="author" content="TradingChango">
  <meta name="robots" content="index, follow">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://tradingchango.com">
  
  <!-- Open Graph -->
  <meta property="og:locale" content="es_AR">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="TradingChango">
  <meta property="og:title" content="TradingChango | Compará Precios de Supermercados">
  <meta property="og:description" content="Compará precios de supermercados en Argentina. Ahorrá hasta 30% en tu carrito.">
  <meta property="og:url" content="https://tradingchango.com">
  <meta property="og:image" content="https://tradingchango.com/og-image.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@tradingchango">
  <meta name="twitter:title" content="TradingChango | Compará Precios">
  <meta name="twitter:description" content="Compará precios de supermercados en Argentina. Ahorrá hasta 30%.">
  <meta name="twitter:image" content="https://tradingchango.com/og-image.jpg">
  
  <!-- Geo Tags para Argentina -->
  <meta name="geo.region" content="AR">
  <meta name="geo.country" content="Argentina">
  <meta name="ICBM" content="-34.6037, -58.3816">
  
  <!-- Favicon y Manifest -->
  <link rel="icon" type="image/png" href="/logo192.png" />
  <link rel="apple-touch-icon" href="/logo192.png" />
  <link rel="manifest" href="/manifest.json" />

  <!-- Font Awesome: Cargar de forma no bloqueante -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>

  <!-- Google Fonts: Cargar de forma no bloqueante -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"></noscript>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RVLYJ69FYD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-RVLYJ69FYD');
  </script>
</head>
<body class="bg-white dark:bg-[#0b141a] text-[#131722] dark:text-[#e9edef]">
    <div id="root"></div>
    <!-- Script principal con defer para no bloquear el render -->
    <script type="module" src="/index.tsx" defer fetchpriority="high"></script>
    <script>
      // Precargar chunks de React Router después de que la página sea interactiva
      window.addEventListener('load', function() {
        // Precargar el bundle principal después de 1.5 segundos
        setTimeout(function() {
          // Buscar cualquier link de prefetch existente y agregarlo si no existe
          var links = document.querySelectorAll('link[rel="prefetch"]');
          var hasPrefetch = false;
          links.forEach(function(link) {
            if (link.href.includes('index-') || link.href.includes('vendor-')) {
              hasPrefetch = true;
            }
          });
          // Los bundles se precargan automáticamente por Vite
        }, 1500);
      });
    </script>
    <script>
      // Diferir service worker hasta que la página sea interactiva
      if ('serviceWorker' in navigator) {
        window.addEventListener('idle', () => {
          navigator.serviceWorker.register('/sw.js');
        });
      }
    </script>
</body>
</html>
